-- Добавляем таблицу для результатов тестов к существующей базе

-- Таблица профориентационного теста
CREATE TABLE IF NOT EXISTS career_tests (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    questions_count INT DEFAULT 30,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Таблица вопросов теста
CREATE TABLE IF NOT EXISTS test_questions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    test_id INT,
    question TEXT NOT NULL,
    category VARCHAR(50),
    FOREIGN KEY (test_id) REFERENCES career_tests(id) ON DELETE CASCADE
);

-- Таблица вариантов ответов
CREATE TABLE IF NOT EXISTS test_options (
    id INT PRIMARY KEY AUTO_INCREMENT,
    question_id INT,
    option_text VARCHAR(255) NOT NULL,
    points INT DEFAULT 0,
    profession_type VARCHAR(50),
    FOREIGN KEY (question_id) REFERENCES test_questions(id) ON DELETE CASCADE
);

-- Таблица результатов теста пользователей
CREATE TABLE IF NOT EXISTS test_results (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(100),
    test_id INT,
    result_data JSON,
    profession_types JSON,
    recommended_professions JSON,
    completion_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (test_id) REFERENCES career_tests(id)
);

-- Вставляем тестовые данные
INSERT INTO career_tests (name, description) VALUES
('Профессиональная ориентация', 'Определение подходящих профессий на основе интересов и склонностей');

-- Вставляем вопросы теста
INSERT INTO test_questions (test_id, question, category) VALUES
(1, 'Вам нравится решать сложные математические задачи?', 'Логика'),
(1, 'Вы часто придумываете новые идеи и проекты?', 'Креативность'),
(1, 'Вам нравится работать с компьютерными программами?', 'Технологии'),
(1, 'Вы хорошо находите общий язык с разными людьми?', 'Коммуникация'),
(1, 'Вам нравится анализировать данные и статистику?', 'Аналитика'),
(1, 'Вы получаете удовольствие от создания красивых вещей?', 'Дизайн'),
(1, 'Вам интересно разбираться в том, как устроены механизмы?', 'Техника'),
(1, 'Вы хорошо организуете работу других людей?', 'Менеджмент'),
(1, 'Вам нравится помогать людям решать их проблемы?', 'Помощь'),
(1, 'Вы внимательны к деталям и точны в работе?', 'Внимательность'),
(1, 'Вам интересны биологические процессы и природа?', 'Наука'),
(1, 'Вы хорошо выступаете перед аудиторией?', 'Презентации'),
(1, 'Вам нравится составлять планы и стратегии?', 'Планирование'),
(1, 'Вы легко осваиваете новые языки?', 'Языки'),
(1, 'Вам интересны финансовые вопросы и инвестиции?', 'Финансы'),
(1, 'Вы получаете удовольствие от обучения других?', 'Обучение'),
(1, 'Вам нравится работать в команде?', 'Команда'),
(1, 'Вы предпочитаете работу по четким инструкциям?', 'Структура'),
(1, 'Вам интересны политические и социальные процессы?', 'Общество'),
(1, 'Вы хорошо справляетесь со стрессовыми ситуациями?', 'Стрессоустойчивость'),
(1, 'Вам нравится исследовать новые технологии?', 'Инновации'),
(1, 'Вы получаете удовольствие от продаж и переговоров?', 'Продажи'),
(1, 'Вам интересно писать тексты и статьи?', 'Письмо'),
(1, 'Вы хорошо разбираетесь в искусстве и культуре?', 'Искусство'),
(1, 'Вам нравится заниматься спортом и физической активностью?', 'Спорт'),
(1, 'Вы интересуетесь психологией и поведением людей?', 'Психология'),
(1, 'Вам нравится работать с цифрами и расчетами?', 'Числа'),
(1, 'Вы получаете удовольствие от путешествий и новых мест?', 'Путешествия'),
(1, 'Вам интересны юридические вопросы и законы?', 'Право'),
(1, 'Вы хорошо запоминаете информацию?', 'Память');

-- Вставляем варианты ответов с баллами для разных типов профессий
INSERT INTO test_options (question_id, option_text, points, profession_type) VALUES
-- Вопрос 1
(1, 'Да, очень нравится', 3, 'Технический'),
(1, 'Иногда', 1, 'Смешанный'),
(1, 'Нет, не нравится', 0, 'Гуманитарный'),

-- Вопрос 2
(2, 'Постоянно придумываю', 3, 'Творческий'),
(2, 'Иногда', 1, 'Смешанный'),
(2, 'Редко', 0, 'Аналитический'),

-- Вопрос 3
(3, 'Очень нравится', 3, 'Технический'),
(3, 'Нормально', 1, 'Смешанный'),
(3, 'Не очень', 0, 'Гуманитарный'),

-- Вопрос 4
(4, 'Да, легко', 3, 'Социальный'),
(4, 'Иногда бывают сложности', 1, 'Смешанный'),
(4, 'Трудно', 0, 'Исследовательский'),

-- Вопрос 5
(5, 'Очень интересно', 3, 'Аналитический'),
(5, 'Иногда', 1, 'Смешанный'),
(5, 'Не интересно', 0, 'Творческий'),

-- Вопрос 6
(6, 'Да, получаю удовольствие', 3, 'Творческий'),
(6, 'Иногда', 1, 'Смешанный'),
(6, 'Нет', 0, 'Аналитический'),

-- Вопрос 7
(7, 'Очень интересно', 3, 'Технический'),
(7, 'Немного', 1, 'Смешанный'),
(7, 'Не интересно', 0, 'Гуманитарный'),

-- Вопрос 8
(8, 'Да, хорошо получается', 3, 'Управленческий'),
(8, 'Иногда', 1, 'Смешанный'),
(8, 'Нет', 0, 'Исполнительский'),

-- Вопрос 9
(9, 'Да, люблю помогать', 3, 'Социальный'),
(9, 'Иногда', 1, 'Смешанный'),
(9, 'Нет', 0, 'Технический'),

-- Вопрос 10
(10, 'Да, очень внимателен', 3, 'Аналитический'),
(10, 'Средне', 1, 'Смешанный'),
(10, 'Не очень', 0, 'Творческий'),

-- Добавляем связь профессий с типами для теста
ALTER TABLE professions ADD COLUMN IF NOT EXISTS profession_types JSON;

UPDATE professions SET profession_types = '["Технический", "Аналитический"]' WHERE name = 'Веб-разработчик';
UPDATE professions SET profession_types = '["Аналитический", "Исследовательский"]' WHERE name = 'Аналитик данных';
UPDATE professions SET profession_types = '["Социальный", "Творческий", "Управленческий"]' WHERE name = 'Маркетолог';
UPDATE professions SET profession_types = '["Технический", "Аналитический"]' WHERE name = 'Инженер-программист';
UPDATE professions SET profession_types = '["Творческий", "Технический"]' WHERE name = 'Дизайнер UX/UI';
UPDATE professions SET profession_types = '["Управленческий", "Социальный"]' WHERE name = 'Менеджер проектов';